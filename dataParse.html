<html>
<head>
<title>HTML/JS/D3 -> R</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
<svg />
<script>

/** 
  Recreate the following steps in R using dplyr and ggplot.
  Look at the comments for names that may suggest interesting functions.
  Your R code should be much shorter.
  */

var temperatures, yearSummary;
var years = [1800,1810,1820,1830,1840,1850,1860,1870,1880,1890,1900,1910,1920,1930,1940,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015];
var population = {};
var coordinates = {};

function mutateRow(row) {
  return row;
}

function addToDict (dict, year, country , pop) {
  tmp = dict[year];
  var x = {}
  if (country in coordinates) {
    coord = coordinates[country]
    stuff = coord.split(',');
    latitude = stuff[0].trim();
    latitude = latitude.substring(0,latitude.length-1);
    latitude = latitude.trim().replace(/ /g,".");
   
    longitude = stuff[1].trim();
    longitude = longitude.substring(0,longitude.length-1);
    longitude = longitude.trim().replace(/ /g,".");
    x = {pop, latitude, longitude};
    tmp[country] = x;
  }
  else {
    tmp[country] = pop;
  }
  
  dict[year] = tmp;
  return dict;
} 

function callback2(error, data) {
  var dict = {};
  data.forEach(function(element) {

     cName = element["Country"];
     cCoord = element["Coordinates"];
     if (cName.indexOf(',') > -1) { 
      cName = cName.split(',');
      cName = cName[1].trim() + " " + cName[0].trim();
      cName = cName.replace(/"/g,"");
    }
    dict[cName] = cCoord;
  });

  coordinates = dict;
}

function callback(error, data) {

  var dict = {}; // {Year, {Country, {Latitude, Longitude, Population Size, Color}}}
  data.forEach(function(element) {
    //console.log(dict);
     for(year in years) {
        if (years[year] in dict) {
          dict = addToDict(dict, years[year], element["Country"], element[years[year]]);
        }
        else {
          var x = {};
          x[element["Country"]] = element[years[year]];
          dict[years[year]] = x;
        }
    }
  });
  population = dict;
  //console.log(population);

}
d3.csv("Nishant/country_center_coordinates.csv", mutateRow, callback2)
d3.csv("Nishant/indicator_gapminder_population.csv", mutateRow, callback);
 
</script>
</body>
</html>